name: Build Docker applications
description: Build Docker applications
author: Antoine Milochau
inputs:
  context:
    description: The path of the context where to build
    required: true
  dockerfile:
    description: The path of the Dockerfile
    required: true
  dockerRegistryHost:
    description: The host of the Docker registry - with a leading slash
    default: 'ghcr.io/'
  dockerRegistryUsername:
    description: The username to login to Docker registry
    required: true
  dockerRegistryPassword:
    description: The password to login to Docker registry
    required: true
  dockerImageName:
    description: The name of the Docker image
    required: true
  dockerImageTag:
    description: The tag of the Docker image
    required: true
runs:
  using: composite
  steps:
    - name: Login to the Container Registry
      uses: azure/docker-login@v1
      with:
        login-server: ${{ inputs.dockerRegistryHost }}
        username: ${{ inputs.dockerRegistryUsername }}
        password: ${{ inputs.dockerRegistryPassword }}
    - name: Build Docker application with script
      shell: pwsh
      run: ${{ github.action_path }}/build-docker.ps1 `
        -context "${{ inputs.context }}" `
        -dockerfile "${{ inputs.dockerfile }}" `
        -dockerRegistryHost ${{ inputs.dockerRegistryHost }} `
        -dockerImageName ${{ inputs.dockerImageName }} `
        -dockerImageTag ${{ inputs.dockerImageTag }}
