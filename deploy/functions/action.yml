name: Deploy Azure Functions application
description: Deploy Azure Functions application
author: Antoine Milochau
inputs:
  dotnetVersion:
    description: The .NET version to use
    default: ''
  azureCredentials:
    description: Azure credentials, typically get from secrets.AZURE_CREDENTIALS
    required: true
  resourceGroupName:
    description: The resource group name, as defined on Azure
    required: true
  applicationName:
    description: The application name, as defined on Azure
    required: true
  projectsToPublishPath:
    description: The path of the projects to publish, relative to the checkout path
    required: true
  relativeHealthUrl:
    description: The relative URL of the health endpoint, from the Functions application
    required: false
    default: '/api/health'
  distSource:
    description: The source of the dist files
    default: 'build'
    options:
    - build
    - artifact
  verbosity:
    description: The verbosity of the scripts
    default: minimal
    options:
    - minimal
    - normal
    - detailed
runs:
  using: composite
  steps:
    - name: Setup .NET Core
      if: ${{ inputs.dotnetVersion != '' }}
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: ${{ inputs.dotnetVersion }}
    - name: Login to Azure
      uses: azure/login@v1
      with:
        creds: ${{ inputs.azureCredentials }}
        enable-AzPSSession: true
    - name: Download artifact
      uses: actions/download-artifact@v3
      if: inputs.distSource == 'artifact'
      with:
        name: build-netcore-BADNAME
    - name: Deploy Functions application
      uses: azure/powershell@v1
      with:
        inlineScript: ${{ github.action_path }}/deploy-functions.ps1 `
          -projectsToPublishPath ${{ inputs.projectsToPublishPath }} `
          -resourceGroupName ${{ inputs.resourceGroupName }} `
          -applicationName ${{ inputs.applicationName }} `
          -relativeHealthUrl ${{ inputs.relativeHealthUrl }} `
          -distSource ${{ inputs.distSource }} `
          -verbosity ${{ inputs.verbosity }}
        azPSVersion: 7.1.0
